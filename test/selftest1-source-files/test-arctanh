"Testing arctanh"

clear

T = prefixform(arctanh(x))
check(T="(arctanh x)")

T = prefixform(arctanh(tanh(x)))
check(T="x")

T = prefixform(arctanh(0))
check(T="0")

T = prefixform(arctanh(1))
check(T="(arctanh 1)")

T = prefixform(arctanh(-1))
check(T="(arctanh -1)")

T = prefixform(arctanh(0.5))
check(T="0.549306")

T = prefixform(arctanh(-0.5))
check(T="-0.549306")

T = prefixform(float(arctanh(1+i)))
check(T="(+ 0.402359 (* 1.01722 (^ -1 1/2)))")

for(x,-12,12,
  d = float(arctanh(x/12)) - arctanh(float(x/12)),
  check(abs(d) < 1.0 10^(-6))
)

-- complex arg

for(x,-3,3,for(y,-3,3,
  z = 1/3.0 (x + i y),
  test(and(1 + z,1 - z),do(
    w = 1/2 log(1 + z) - 1/2 log(1 - z),
    check(abs(arctanh(z) - w) < 1.0 10^(-6))
  ))
))

z1 =  0.2 + 0.3 i
z2 =  0.2 - 0.3 i
z3 = -0.2 + 0.3 i
z4 = -0.2 - 0.3 i

check(infixform(arctanh(tanh(z1))) == infixform(z1))
check(infixform(arctanh(tanh(z2))) == infixform(z2))
check(infixform(arctanh(tanh(z3))) == infixform(z3))
check(infixform(arctanh(tanh(z4))) == infixform(z4))
