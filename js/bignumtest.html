<html>
<body style="font-family:courier;font-size:16pt">

<script src="bignum.js"></script>
<script src="bignum_add.js"></script>
<script src="bignum_sub.js"></script>
<script src="bignum_mul.js"></script>
<script src="bignum_div.js"></script>
<script src="bignum_mod.js"></script>
<script src="bignum_pow.js"></script>
<script src="bignum_root.js"></script>
<script src="bignum_cmp.js"></script>
<script src="bignum_atoi.js"></script>
<script src="bignum_itoa.js"></script>

<script>

var stdout;

function
run()
{
        stdout = document.getElementById("stdout");
	stdout.innerHTML = "";

	test_bignum_add();
	test_bignum_sub();
	test_bignum_mul();
	test_bignum_div();
	test_bignum_mod();
	test_bignum_pow();
	test_bignum_root();

	test_combo();

	printline("ok");
}

function
test_bignum_add()
{
	printline("Testing bignum_add");

	for (i = 0; i < 10000; i++) {
		a = Math.floor(Math.random() * 16 * BIGM);
		b = Math.floor(Math.random() * 16 * BIGM);
		u = bignum_atoi(String(a));
		v = bignum_atoi(String(b));
		w = bignum_add(u, v);
		s = bignum_itoa(w);
		if (a + b != Number(s)) {
			fail(a, b, s);
			return;
		}
	}
}

function
test_bignum_sub()
{
	printline("Testing bignum_sub");

	for (i = 0; i < 10000; i++) {
		a = Math.floor(Math.random() * 16 * BIGM);
		b = Math.floor(Math.random() * 16 * BIGM);
		if (a < b) {
			t = a;
			a = b;
			b = t;
		}
		u = bignum_atoi(String(a));
		v = bignum_atoi(String(b));
		w = bignum_sub(u, v);
		s = bignum_itoa(w);
		if (a - b != Number(s)) {
			fail(a, b, s);
			return;
		}
	}
}

function
test_bignum_mul()
{
	printline("Testing bignum_mul");

	for (i = 0; i < 10000; i++) {
		a = Math.floor(Math.random() * 16 * BIGM);
		b = Math.floor(Math.random() * BIGM / 16);
		u = bignum_atoi(String(a));
		v = bignum_atoi(String(b));
		w = bignum_mul(u, v);
		s = bignum_itoa(w);
		if (a * b != Number(s)) {
			fail(a, b, s);
			return;
		}
	}
}

function
test_bignum_div()
{
	printline("Testing bignum_div");

	for (i = 0; i < 10000; i++) {
		a = Math.floor(Math.random() * 16 * BIGM);
		b = Math.floor(Math.random() * BIGM / 16);
		u = bignum_atoi(String(a));
		v = bignum_atoi(String(b));
		w = bignum_div(u, v);
		s = bignum_itoa(w);
		if (Math.floor(a / b) != Number(s)) {
			fail(a, b, s);
			return;
		}
	}
}

function
test_bignum_mod()
{
	printline("Testing bignum_mod");

	for (i = 0; i < 10000; i++) {
		a = Math.floor(Math.random() * 16 * BIGM);
		b = Math.floor(Math.random() * BIGM / 16);
		u = bignum_atoi(String(a));
		v = bignum_atoi(String(b));
		w = bignum_mod(u, v);
		s = bignum_itoa(w);
		if (a % b != Number(s)) {
			fail(a, b, s);
			return;
		}
	}
}

function
test_bignum_pow()
{
	printline("Testing bignum_pow");

	for (a = 0; a < 13; a++)
		for (b = 0; b < 13; b++) {
			u = bignum_atoi(String(a));
			v = bignum_atoi(String(b));
			w = bignum_pow(u, v);
			s = bignum_itoa(w);
			if (Math.pow(a, b) != Number(s)) {
				fail(a, b, s);
				return;
			}
		}

	u = bignum_atoi("2");
	v = bignum_atoi("48");
	w = bignum_pow(u, v);
	s = bignum_itoa(w);
	if (Number(s) != 281474976710656)
		printline("fail 2^48");

	u = bignum_atoi("3");
	v = bignum_atoi("30");
	w = bignum_pow(u, v);
	s = bignum_itoa(w);
	if (Number(s) != 205891132094649)
		printline("fail 3^30");

	u = bignum_atoi("5");
	v = bignum_atoi("20");
	w = bignum_pow(u, v);
	s = bignum_itoa(w);
	if (Number(s) != 95367431640625)
		printline("fail 5^20");
}

function
test_bignum_root()
{
	printline("Testing bignum_root");

	for (a = 0; a < 13; a++)
		for (b = 1; b < 13; b++) {
			u = bignum_atoi(String(a));
			v = bignum_atoi(String(b));
			w = bignum_pow(u, v);
			w = bignum_root(w, v);
			if (w == null) {
				fail(a, b, "?");
				return;
			}
			s = bignum_itoa(w);
			if (a != Number(s)) {
				fail(a, b, s);
				return;
			}
		}

	u = bignum_atoi("281474976710656");
	v = bignum_atoi("48");
	w = bignum_root(u, v);
	s = bignum_itoa(w);
	if (Number(s) != 2)
		printline("fail 2^48");

	u = bignum_atoi("205891132094649");
	v = bignum_atoi("30");
	w = bignum_root(u, v);
	s = bignum_itoa(w);
	if (Number(s) != 3)
		printline("fail 3^30");

	u = bignum_atoi("95367431640625");
	v = bignum_atoi("20");
	w = bignum_root(u, v);
	s = bignum_itoa(w);
	if (Number(s) != 5)
		printline("fail 5^20");
}

const A = [
[0x000000],
[0x000001],
[0x800000],
[0xffffff],
[0x000000,0x000000,0x000001],
[0x000000,0x000000,0x800000],
[0xffffff,0xffffff,0xffffff],
[0x000000,0x000000,0x000000,0x000001],
];

const B = [
[0x000001],
[0x800000],
[0x000000,0x000001],
[0xffffff,0x000001],
[0x000001,0x000000,0x000001],
];

function
test_combo()
{
	printline("Testing combo");

	for (i = 0; i < A.length; i++)
		for (j = 0; j < B.length; j++)
			test_combo_nib(A[i], B[j]);

	printline("");
}

function
test_combo_nib(a, b)
{
	q = bignum_div(a, b);
	r = bignum_mod(a, b);

	t = bignum_mul(b, q);
	t = bignum_add(t, r);

	if (bignum_cmp(a, t) == 0)
		stdout.innerHTML += ".";
	else
		printline("fail");
}

function
fail(a, b, s)
{
	printline("fail " + a + " " + b + " " + s);
}

function
printline(s)
{
	stdout.innerHTML += s + "<br>";
}
</script>

<button onclick="run()" style="font-size:20pt">Run</button>

<p>
<div id="stdout"></div>

</body>
</html>
